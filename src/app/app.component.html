<div class="container">
  <div class="header">
    <h1>{{ title() }}</h1>
    <p>Analiza comprobantes electr√≥nicos</p>
  </div>

  <div class="upload-card">
    <h3>üì§ Subir Comprobante (PDF)</h3>
    <input type="file" (change)="onFileSelected($event)" accept=".pdf" [disabled]="cargando()">
    <div *ngIf="cargando()" style="margin-top: 15px; color: #3b82f6; font-weight: 500;">
        <span class="spinner">‚öôÔ∏è</span>Procesando con IA..
    </div>
  </div>

  <div style="display: flex; justify-content: flex-end; margin: 20px 0;">
    <button class="btn-excel" (click)="generarExcel()">
      üìä Descargar Excel
    </button>
  </div>

  <div class="table-responsive">
    <table>
      <thead>
        <tr>
          <th>Emisor</th>
          <th>RUC / NIT</th>
          <th>Fecha</th>
          <th>Total</th>
          <th>Moneda</th> <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let f of facturas()">
          <ng-container *ngIf="!f.editando">
            <td>{{ f.emisor }}</td>
            <td>{{ f.nitOId }}</td>
            <td>{{ f.fecha | date:'dd/MM/yyyy' }}</td>
            <td style="font-weight: bold;">{{ f.totalPagar | number:'1.2-2' }}</td>
            <td><span class="currency-badge">{{ f.moneda }}</span></td>
            <td class="actions-cell">
              <button class="btn btn-edit" (click)="f.editando = true">Editar</button>
              <button class="btn btn-delete" (click)="eliminarFactura(f.id)">Eliminar</button>
            </td>
          </ng-container>

          <ng-container *ngIf="f.editando">
            <td><input class="edit-input" [(ngModel)]="f.emisor"></td>
            <td><input class="edit-input" [(ngModel)]="f.nitOId"></td>
            <td><input class="edit-input" type="date" [ngModel]="f.fecha | date:'yyyy-MM-dd'" (ngModelChange)="f.fecha=$event"></td>
            <td><input class="edit-input" type="number" [(ngModel)]="f.totalPagar"></td>
            <td>
              <select class="edit-select" [(ngModel)]="f.moneda">
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
                <option value="GBP">GBP</option>
                <option value="MXN">MXN</option>
              </select>
            </td>
            <td class="actions-cell">
              <button class="btn btn-save" (click)="guardarCambios(f)">Guardar</button>
              <button class="btn btn-cancel btn-small" (click)="f.editando = false">X</button>
            </td>
          </ng-container>
        </tr>
      </tbody>
    </table>
  </div>
</div>